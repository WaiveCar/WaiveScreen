#!/bin/bash

CP="cp -pvu"
USER=adorno
DEST=/home/$USER

cp -pvuTr ../files/home $DEST
chmod 0600 $DEST/.ssh/KeyBounce $DEST/.ssh/github $DEST/.ssh/dev

# xinit is going to be at a root level
$CP ../files/home/.xinitrc ~root
rm $DEST/.xinitrc

# The overly user-hostile version of sudo needs to be fixed
ainsl /etc/sudoers "$USER ALL=NOPASSWD: ALL" "$USER"

# The retarded default bell thing in bash to do nothing
# on tab complete needs to go
sed -i '/^# set bell-style none/s/^# //' /etc/inputrc

# This stupid smarmy "plan your install" crap needs to go.
[ -e /etc/motd ] && sudo rm -f /etc/motd   

cpfile() {

  if [ ! -e "../files"$1 ]; then
    echo "FAILURE! CANNOT FIND $1"
  else
    echo "Copying $1"
  fi

  $CP "../files"$1 $1
}

# A bunch of stupid modules shouldn't be loaded.
cpfile /etc/modprobe.d/blacklist.conf
cpfile /etc/udev/rules.d/45-arduino.rules
cpfile /etc/logrotate.d/screen.log

for path in /var/log/screen /var/db/; do
  mkdir -p $path
  chmod 0777 $path
done

# Swap may be needed for ACPI
#sed -i '/swap/d' /etc/fstab

# apt purge -y rpcbind

# Gives the user perms for arduino
usermod -G dialout -a $USER

chsh -s /bin/bash $USER

# Optimize the screen for power
#powertop --auto-tune --debug

# Make sure the paths from the lib are shared to the shell
ainsl $DEST/.bashrc 'source $HOME/dcall nop' 'dcall nop'
$DEST/dcall uuid
